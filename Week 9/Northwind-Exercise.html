<html>
  <head>
    <title>Northwind Exercise</title>
    <script>
      const baseUrl = "https://services.odata.org/Northwind/Northwind.svc/";

      async function GetData(url) {
        let allData = [];
        while (url) {
          const response = await fetch(url, {
            headers: {
              Accept: "application/json",
            },
          });

          if (!response.ok) {
            console.error("Failed to fetch data:", response.status, response.statusText);
            break;
          }

          const text = await response.json();
          const data = text.value;
          allData = allData.concat(data);

          url = text["odata.nextLink"]
            ? baseUrl + text["odata.nextLink"] + "&$format=json"
            : null;
        }
        return allData;
      }

      async function PopulateTable() {
        const initialUrl = baseUrl + "Orders?$format=json";
        const dataOut = await GetData(initialUrl);
        const table = document.querySelector("tbody");

        dataOut.forEach((order, index) => {
          const row = document.createElement("tr");
          row.style.backgroundColor = index % 2 === 0 ? "lightblue" : "lightgray";

          const orderIdCell = document.createElement("td");
          orderIdCell.textContent = order.OrderID;
          row.appendChild(orderIdCell);

          const destinationCell = document.createElement("td");
          destinationCell.textContent = `${order.ShipName}, ${order.ShipAddress}, ${order.ShipCity}, ${order.ShipPostalCode}, ${order.ShipCountry}`;
          row.appendChild(destinationCell);

          table.appendChild(row);
        });
      }

      PopulateTable();
    </script>
  </head>

  <body>
    <h1>Northwind Exercise</h1>
    <p>
      The REST URL
      <a
        href="https://services.odata.org/Northwind/Northwind.svc/Orders?$format=json"
        target="_blank"
      >
        https://services.odata.org/Northwind/Northwind.svc/Orders?$format=json
      </a>
      provides a list of orders from the Northwind database. The orders contain,
      among other things, an order id and a destination for the order. We are
      asked to write an application showing the order ids and the corresponding
      destinations.
    </p>
    <table>
      <thead>
        <tr>
          <th>Order ID</th>
          <th>Destination</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </body>
</html>
